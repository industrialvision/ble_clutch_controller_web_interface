<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clutch and Throttle Settings</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    /* Основные стили */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f9;
    }
    h1, h2, h3 {
      text-align: center;
    }
    h1 {
      margin-top: 0px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      margin: 5px;
      cursor: pointer;
      width: 47%;
      box-sizing: border-box;
          }
    .button-red {
    background-color: red !important;
    color: white;
    }
    .button-red:hover {
      background-color: rgb(255, 75, 75) !important;
      color: white;
    }
    button:hover {
      background-color: #45a049;
    }
    .container {
      padding: 10px;
      margin-left: auto;
      margin-right: auto;
      display: block;
    }
    .connectionContainer {
       display: flex;
  justify-content: center;
  gap: 10px; /* Optional: adds space between buttons */
  margin: 10px 0; /* Optional: adds vertical margin */
          }
    .container p {
      font-size: 18px;
      text-align: center;
    }
    .chart-container {
      width: 100%;
      height: 0;
      padding-bottom: 50%;
      position: relative;
    }
    #verticalVoltageLine {
      position: absolute;
      top: 240px;
      height: 320px;
      bottom: 0;
      width: 2px;
      background-color: red;
      transition: left 0.3s ease;
      z-index: 20;
    }
    #bikeLockButton {
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    @media screen and (max-width: 768px) {
      h1 { font-size: 24px; }
      h2 { font-size: 14px; }
      h3 { font-size: 20px; }
      .container p { font-size: 16px; }
      button { font-size: 12px; }
      #voltageLine { width: 100%; height: 5px; }
    }
    .slider-container {
            position: relative;
            width: 100%;
        }
        /* Styling the range input */
        input[type="range"] {
            -webkit-appearance: none; /* Removes default styles for Safari */
            appearance: none;
            width: 100%;
            height: 6px;
            background: linear-gradient(to right, #2a86d6 0%, #2a86d6 85%, #d3d3d3 85%, #d3d3d3 100%);
            border-radius: 5px;
            outline: none;
            margin: 10px 0;
            transition: background 0.3s ease;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; /* Removes default styles for Safari */
            appearance: none;
            width: 20px;
            height: 20px;
            background: #fff;
            border: 2px solid #2a86d6;
            border-radius: 50%;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #fff;
            border: 2px solid #2a86d6;
            border-radius: 50%;
            cursor: pointer;
        }
        /* Tooltip styling - HIDDEN as per request */
      .tooltip {
    display: none !important; 
}

        /* Styles for new Audio Select */
        .audio-select {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background: white;
            margin-top: 5px;
        }
  </style>
</head>
<body>
  <div class="container">
    <h1>Clutch and Throttle Settings</h1>
    <div class="connectionContainer">
    <button id="connectBleButton">Connect</button>
    <button id="disconnectBleButton">Disconnect</button>
    </div>
    <p>State: <strong><span id="bleState" style="color:#d13a30;">Disconnected</span></strong></p> 
    <button id="bikeLockButton">Bike locked</button>
    <div class="chart-container">
      <canvas id="chartJSContainer"></canvas>
    </div><div class="flex justify-center items-center mt-5 space-x-4">

  <button id="saveDropdownValue"
          class="px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-md shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
    Save
  </button>
   <button id="loadDropdownValue"
   class="px-4 py-2 bg-green-500 text-white text-sm font-medium rounded-md shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
    Load
  </button>
  <button id="setDefaultValue"
          class="px-4 py-2 bg-gray-500 text-white text-sm font-medium rounded-md shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">
    Default
  </button></div>
 

    <h2>Flywheel Effect Acceleration</h2>
    <div class="slider-container">
      <div class="tooltip" id="tooltip1">15</div>
      <input type="range" id="slider1" min="1" max="30" value="15">
    </div>
    <h2>Flywheel Effect Deceleration</h2>
    <div class="slider-container">
      <div class="tooltip" id="tooltip3">15</div>
      <input type="range" id="slider3" min="1" max="30" value="15">
    </div>
 <h2>Clutch engagement speed</h2>
    <div class="slider-container">
      <div class="tooltip" id="tooltip4">15</div>
      <input type="range" id="slider4" min="1" max="81" value="15">
    </div>

    <div class="p-4 mt-6 bg-gray-100 rounded-lg shadow-inner">
        <h2 class="text-xl font-bold mb-4">Engine Sound Settings</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <label class="block text-sm font-bold text-gray-700">Volume</label>
                <div class="slider-container">
                    <div class="tooltip" id="volTip">50</div>
                    <input type="range" id="volSlider" min="0" max="100" value="50">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700">Waveform (Timbre)</label>
                <select id="waveType" class="audio-select">
                    <option value="sawtooth">Sawtooth (Engine-like)</option>
                    <option value="sine">Sine (Soft)</option>
                    <option value="square">Square (Aggressive)</option>
                    <option value="triangle">Triangle (Hollow)</option>
                </select>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700">Idle Freq (Hz)</label>
                <div class="slider-container">
                    <div class="tooltip" id="freqMinTip">40</div>
                    <input type="range" id="freqMinSlider" min="20" max="200" value="40">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold text-gray-700">Max Freq (Hz)</label>
                <div class="slider-container">
                    <div class="tooltip" id="freqMaxTip">300</div>
                    <input type="range" id="freqMaxSlider" min="100" max="1000" value="300">
                </div>
            </div>
        </div>
    </div>

    
    <h3 class="mt-8">Clutch calibration</h3>
    <div class="inline-row">
      <div class="connectionContainer">
        <button id="savePressedButton">Save Clutch Pressed</button>
        <button id="saveReleasedButton">Save Clutch Released</button>
      </div>
            <p><span id="voltageContainerA0">-</span> | <span id="fullyPressedValueA0">-</span> | <span id="fullyReleasedValueA0">-</span></p>
      <h3>Throttle calibration</h3>
      <div class="connectionContainer">
        <button id="savePressedButtonA1">Save Throttle Open</button>
        <button id="saveReleasedButtonA1">Save Throttle Closed</button>
      </div>
            <p><span id="voltageContainerA1">-</span> | <span id="fullyPressedValueA1">-</span> | <span id="fullyReleasedValueA1">-</span></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/lodash"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-dragdata"></script>

  <script>
    let audioCtx = null, oscillator = null, gainNode = null;
    let masterVol = 0.5, freqMin = 40, freqMax = 300;

    function saveAudioSettings() {
        const settings = {
            masterVol: masterVol,
            freqMin: freqMin,
            freqMax: freqMax,
            currentWave: document.getElementById('waveType').value
        };
        localStorage.setItem('audioSettings', JSON.stringify(settings));
    }

    function loadAudioSettings() {
        const saved = localStorage.getItem('audioSettings');
        if (saved) {
            const s = JSON.parse(saved);
            masterVol = s.masterVol;
            freqMin = s.freqMin;
            freqMax = s.freqMax;
            
            document.getElementById('volSlider').value = masterVol * 100;
            document.getElementById('freqMinSlider').value = freqMin;
            document.getElementById('freqMaxSlider').value = freqMax;
            document.getElementById('waveType').value = s.currentWave;
        }
    }

    function initAudio() {
        if (audioCtx) return;
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        oscillator = audioCtx.createOscillator();
        gainNode = audioCtx.createGain();
        const filter = audioCtx.createBiquadFilter();
        
        filter.type = 'lowpass';
        filter.frequency.setValueAtTime(600, audioCtx.currentTime);
        oscillator.type = document.getElementById('waveType').value;
        gainNode.gain.setValueAtTime(0, audioCtx.currentTime);

        oscillator.connect(filter);
        filter.connect(gainNode);
        gainNode.connect(audioCtx.destination);
        oscillator.start();
    }

   let lastSoundUpdate = 0;
   function updateEngineSound(v, minV, maxV) {
       if (!audioCtx || !oscillator || !gainNode) return;
       const now = performance.now();
       if (now - lastSoundUpdate < 20) return; 
       lastSoundUpdate = now;

       let norm = (v - minV) / (maxV - minV);
       norm = Math.max(0, Math.min(1, norm));
       
       const freq = freqMin + (norm * (freqMax - freqMin));
       oscillator.frequency.setTargetAtTime(freq, audioCtx.currentTime, 0.05);
       
       const targetVol = masterVol * (0.2 + (norm * 0.8));
       gainNode.gain.setTargetAtTime(v === 0 ? 0 : targetVol, audioCtx.currentTime, 0.05);
   }
  </script>

  <script>
    function updateSlider(slider, tooltip, color = "#2a86d6") {
        const value = slider.value;
        const percentage = (value - slider.min) / (slider.max - slider.min) * 100;
        slider.style.background = `linear-gradient(to right, ${color} ${percentage}%, #d3d3d3 ${percentage}%)`;
    }

    const slider1 = document.getElementById("slider1");
    const tooltip1 = document.getElementById("tooltip1");
    slider1.addEventListener("input", () => updateSlider(slider1, tooltip1));

    const slider3 = document.getElementById("slider3");
    const tooltip3 = document.getElementById("tooltip3");
    slider3.addEventListener("input", () => updateSlider(slider3, tooltip3));

    const slider4 = document.getElementById("slider4");
    const tooltip4 = document.getElementById("tooltip4");
    slider4.addEventListener("input", () => updateSlider(slider4, tooltip4));

    document.getElementById('volSlider').addEventListener('input', (e) => {
        masterVol = e.target.value / 100;
        updateSlider(e.target, document.getElementById('volTip'), "#f59e0b");
        saveAudioSettings();
    });
    document.getElementById('freqMinSlider').addEventListener('input', (e) => {
        freqMin = parseInt(e.target.value);
        updateSlider(e.target, document.getElementById('freqMinTip'), "#3b82f6");
        saveAudioSettings();
    });
    document.getElementById('freqMaxSlider').addEventListener('input', (e) => {
        freqMax = parseInt(e.target.value);
        updateSlider(e.target, document.getElementById('freqMaxTip'), "#ef4444");
        saveAudioSettings();
    });
    document.getElementById('waveType').addEventListener('change', (e) => {
        if (oscillator) oscillator.type = e.target.value;
        saveAudioSettings();
    });

    loadAudioSettings();
    updateSlider(slider3, tooltip3);
    updateSlider(slider1, tooltip1);
    updateSlider(slider4, tooltip4);
    updateSlider(document.getElementById('volSlider'), document.getElementById('volTip'), "#f59e0b");
    updateSlider(document.getElementById('freqMinSlider'), document.getElementById('freqMinTip'), "#3b82f6");
    updateSlider(document.getElementById('freqMaxSlider'), document.getElementById('freqMaxTip'), "#ef4444");
  </script>

  <script>
    const chartConfiguration = {
      type: "line",
      options: {
        plugins: { datalabels: { display: false } },
        scales: {
          x: { type: "linear", min: 0, max: 100, ticks: { display: false }, grid: { display: true } },
          y: { min: 0, max: 100, ticks: { display: false }, grid: { display: true } }
        },
      },
      data: {
        labels: Array.from({ length: 10 }, (_, i) => `Point ${i + 1}`),
        datasets: [
          {
            label: "Clutch",
            data: JSON.parse(localStorage.getItem('chartDataClutch')) || [
              { x: 0, y: 0 }, { x: 10, y: 38 }, { x: 20, y: 54 },
              { x: 30, y: 65 }, { x: 40, y: 75 }, { x: 50, y: 80 },
              { x: 60, y: 83 }, { x: 70, y: 87 }, { x: 80, y: 91 }, { x: 90, y: 96 },
              { x: 100, y: 100 }
            ],
            fill: true,
            tension: 0.4,
            borderWidth: 2,
            pointHitRadius: 25,
          },
          {
            label: "Gas",
            data: JSON.parse(localStorage.getItem('chartDataGas')) || [
              { x: 0, y: 0 }, { x: 10, y: 10 }, { x: 20, y: 20 },
              { x: 30, y: 30 }, { x: 40, y: 40 }, { x: 50, y: 50 },
              { x: 60, y: 60 }, { x: 70, y: 70 }, { x: 80, y: 80 }, { x: 90, y: 90 },
              { x: 100, y: 100 }
            ],
            fill: true,
            tension: 0.4,
            borderWidth: 2,
            pointHitRadius: 25,          },
        ],
      },
    };

    let myChart;
    document.body.onload = function () {
      const ctx = document.getElementById("chartJSContainer").getContext("2d");
      myChart = new Chart(ctx, chartConfiguration);
      myChart.options.plugins.dragData = {
        onDragEnd: function () {
          localStorage.setItem('chartDataClutch', JSON.stringify(myChart.data.datasets[0].data));
          localStorage.setItem('chartDataGas', JSON.stringify(myChart.data.datasets[1].data));
        }
      };
    };
  </script><script>
    const connectButton = document.getElementById('connectBleButton');
    const disconnectButton = document.getElementById('disconnectBleButton');
    const bleStateContainer = document.getElementById('bleState');
    const voltageContainerA0 = document.getElementById('voltageContainerA0');
    const voltageContainerA1 = document.getElementById('voltageContainerA1');
    const fullyPressedValueA0Container = document.getElementById('fullyPressedValueA0');
    const fullyReleasedValueA0Container = document.getElementById('fullyReleasedValueA0');
    const fullyPressedValueA1Container = document.getElementById('fullyPressedValueA1');
    const fullyReleasedValueA1Container = document.getElementById('fullyReleasedValueA1');
    const savePressedButton = document.getElementById('savePressedButton');
    const saveReleasedButton = document.getElementById('saveReleasedButton');
    const savePressedButtonA1 = document.getElementById('savePressedButtonA1');
    const saveReleasedButtonA1 = document.getElementById('saveReleasedButtonA1');
    const bikeLockButton = document.getElementById('bikeLockButton');
    const deviceName = 'Stark_Clutch';
    const bleServiceUuid = '19b10000-e8f2-537e-4f6c-d104768a1214';
    const sensorCharacteristicUuid = '19b10001-e8f2-537e-4f6c-d104768a1214';
    const commandCharacteristicUuid = '19b10002-e8f2-537e-4f6c-d104768a1214';
    const coefsCharacteristicUuid = '19b10004-e8f2-537e-4f6c-d104768a1214';
    const defCoefsCharacteristicUuid = '19b10005-e8f2-537e-4f6c-d104768a1214';
    const analogCoefCharacteristicUuid1 = '19b10006-e8f2-537e-4f6c-d104768a1214';
    const analogStepCharacteristicUuid1 = '19b10007-e8f2-537e-4f6c-d104768a1214';
    const analogCoefCharacteristicUuid2 = '19b10008-e8f2-537e-4f6c-d104768a1214';
    const analogStepCharacteristicUuid2 = '19b10009-e8f2-537e-4f6c-d104768a1214';
    const bikeLockCharacteristicUuid = '19b10010-e8f2-537e-4f6c-d104768a1214';

    class BLEOperationQueue {
      constructor() { this.queue = []; this.isProcessing = false; }
      enqueue(operation) { return new Promise((resolve, reject) => { this.queue.push({ operation, resolve, reject }); this.processQueue(); }); }
      async processQueue() {
        if (this.isProcessing || this.queue.length === 0) return;
        this.isProcessing = true;
        await new Promise(r => setTimeout(r, 10));
        const { operation, resolve, reject } = this.queue.shift();
        try { const result = await operation(); resolve(result); } catch (error) { reject(error); } finally { this.isProcessing = false; this.processQueue(); }
      }
    }
    const bleQueue = new BLEOperationQueue();
    let bleDevice, sensorCharacteristic, commandCharacteristic, coefsCharacteristic, defCoefsCharacteristic;
    let analogCoefCharacteristic1, analogStepCharacteristic1, analogCoefCharacteristic2, analogStepCharacteristic2, bikeLockCharacteristic;
    let bikeLockStatus = false;

    connectButton.addEventListener('click', async () => {
      try {
        initAudio(); 
        bleDevice = await navigator.bluetooth.requestDevice({ filters: [{ name: deviceName }], optionalServices: [bleServiceUuid] });
        const server = await bleDevice.gatt.connect();
        bleStateContainer.textContent = 'Connected';
        bleStateContainer.style.color = "#24af24";
        const service = await server.getPrimaryService(bleServiceUuid);
        sensorCharacteristic = await service.getCharacteristic(sensorCharacteristicUuid);
        commandCharacteristic = await service.getCharacteristic(commandCharacteristicUuid);
        coefsCharacteristic = await service.getCharacteristic(coefsCharacteristicUuid);
        defCoefsCharacteristic = await service.getCharacteristic(defCoefsCharacteristicUuid);
        analogCoefCharacteristic1 = await service.getCharacteristic(analogCoefCharacteristicUuid1);
        analogStepCharacteristic1 = await service.getCharacteristic(analogStepCharacteristicUuid1);
        analogCoefCharacteristic2 = await service.getCharacteristic(analogCoefCharacteristicUuid2);
        analogStepCharacteristic2 = await service.getCharacteristic(analogStepCharacteristicUuid2);
        try { bikeLockCharacteristic = await service.getCharacteristic(bikeLockCharacteristicUuid); } catch (err) { bikeLockCharacteristic = null; }
        sensorCharacteristic.startNotifications();
        sensorCharacteristic.addEventListener('characteristicvaluechanged', handleCharacteristicValueChanged);
        await new Promise(r => setTimeout(r, 1000));
        if (bikeLockCharacteristic) { await fetchBikeLockStateFromBle(); bikeLockButton.style.visibility='visible'; }
        await fetchChartDataFromBle();
        await loadSliderValuesFromBle();
      } catch (error) { bleStateContainer.textContent = 'Failed: ' + error; bleStateContainer.style.color = "#d13a30"; }
    });

    disconnectButton.addEventListener('click', () => {
      if (bleDevice && bleDevice.gatt.connected) {
        bleDevice.gatt.disconnect();
        bleStateContainer.textContent = 'Disconnected';
        bleStateContainer.style.color = "#d13a30";
        if(gainNode) gainNode.gain.setValueAtTime(0, audioCtx.currentTime);
      }
    });

    const handleCharacteristicValueChanged = (event) => {
      const value = new TextDecoder().decode(event.target.value);
      const data = value.split(',');
      if (data.length === 6) {
        const curA0 = parseFloat(data[0]);
        const curA1 = parseFloat(data[3]);
        const prsA1 = parseFloat(data[4]);
        const relA1 = parseFloat(data[5]);

        voltageContainerA0.textContent = curA0;
        voltageContainerA1.textContent = curA1;
        fullyPressedValueA0Container.textContent = data[1];
        fullyReleasedValueA0Container.textContent = data[2];
        fullyPressedValueA1Container.textContent = prsA1;
        fullyReleasedValueA1Container.textContent = relA1;
        
        // ЗВУК ПРИВЯЗАН К A1 (ГАЗ)
        updateEngineSound(curA1, relA1, prsA1);
      }
    };

    async function loadSliderValuesFromBle() {
        try {
            const c1 = await bleQueue.enqueue(() => analogCoefCharacteristic1.readValue());
            slider1.value = new Float32Array(c1.buffer)[0] * 100;
            updateSlider(slider1, tooltip1);
            const c2 = await bleQueue.enqueue(() => analogCoefCharacteristic2.readValue());
            slider3.value = new Float32Array(c2.buffer)[0] * 100;
            updateSlider(slider3, tooltip3);
            const s2 = await bleQueue.enqueue(() => analogStepCharacteristic2.readValue());
            slider4.value = new Int16Array(s2.buffer)[0];
            updateSlider(slider4, tooltip4);
        } catch (e) { console.error(e); }
    }

    async function updateAnalogCoef1(v) { const b = new Float32Array([v/100]); await bleQueue.enqueue(() => analogCoefCharacteristic1.writeValue(b)); }
    async function updateAnalogCoef2(v) { const b = new Float32Array([v/100]); await bleQueue.enqueue(() => analogCoefCharacteristic2.writeValue(b)); }
    async function updateAnalogStep2(v) { const b = new Int16Array([v]); await bleQueue.enqueue(() => analogStepCharacteristic2.writeValue(b)); }

    async function fetchChartDataFromBle() {
        const val = await bleQueue.enqueue(() => coefsCharacteristic.readValue());
        const dArr = new Float64Array(val.buffer);
        if (dArr.length === 22) {
            myChart.data.datasets[0].data = Array.from(dArr).slice(0, 11).map((y, i) => ({ x: i * 10, y }));
            myChart.data.datasets[1].data = Array.from(dArr).slice(11, 22).map((y, i) => ({ x: i * 10, y }));
            myChart.update();
        }
    }

    async function fetchDefaultDataFromBle() {
        const val = await bleQueue.enqueue(() => defCoefsCharacteristic.readValue());
        const dArr = new Float64Array(val.buffer);
        if (dArr.length === 22) {
            myChart.data.datasets[0].data = Array.from(dArr).slice(0, 11).map((y, i) => ({ x: i * 10, y }));
            myChart.data.datasets[1].data = Array.from(dArr).slice(11, 22).map((y, i) => ({ x: i * 10, y }));
            myChart.update();
        }
    }

    async function fetchBikeLockStateFromBle() {
        const val = await bleQueue.enqueue(() => bikeLockCharacteristic.readValue());
        bikeLockStatus = new Int8Array(val.buffer)[0] !== 0;
        updateButtonColor();
    }

    async function switchBikeLockState() {
        await bleQueue.enqueue(() => bikeLockCharacteristic.writeValue(new Uint8Array([!bikeLockStatus])));
        fetchBikeLockStateFromBle();
    }

    function updateButtonColor() {
        bikeLockButton.classList.toggle("button-red", bikeLockStatus);
        bikeLockButton.innerHTML = bikeLockStatus ? "Bike locked" : "Bike unlocked";
    }

    async function sendChartDataToBle(chartData) {
        const combined = new Float64Array([...chartData.datasets[0].data.map(p => p.y), ...chartData.datasets[1].data.map(p => p.y)]);
        await bleQueue.enqueue(() => coefsCharacteristic.writeValue(new Uint8Array(combined.buffer)));
    }

    function addCommandListener(btn, cmd) {
        btn.addEventListener('click', async () => {
            if (commandCharacteristic) await bleQueue.enqueue(() => commandCharacteristic.writeValue(new TextEncoder().encode(cmd)));
        });
    }

    addCommandListener(savePressedButton, "Fully Pressed A0");
    addCommandListener(saveReleasedButton, "Fully Released A0");
    addCommandListener(savePressedButtonA1, "Fully Pressed A1");
    addCommandListener(saveReleasedButtonA1, "Fully Released A1");

    slider1.addEventListener("input", () => updateAnalogCoef1(slider1.value));
    slider3.addEventListener("input", () => updateAnalogCoef2(slider3.value));
    slider4.addEventListener("input", () => updateAnalogStep2(slider4.value));

    document.getElementById('saveDropdownValue').addEventListener('click', () => sendChartDataToBle(myChart.data));
    document.getElementById('loadDropdownValue').addEventListener('click', fetchChartDataFromBle);
    document.getElementById('setDefaultValue').addEventListener('click', fetchDefaultDataFromBle);
    document.getElementById('bikeLockButton').addEventListener('click', switchBikeLockState);
    updateButtonColor();
</script>
<script>
    Math.map = function (value, in_min, in_max, out_min, out_max) {
      return (value - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;
    };
</script>
</body>
</html>